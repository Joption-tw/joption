<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雙賣動態平衡模擬器</title>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { margin: 0; padding: 0; background-color: #f3f4f6; }
        .wood-texture {
            background-color: #8B4513;
            background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent);
            background-size: 20px 20px;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 圖示組件 ---
        const SeesawLogo = ({ size = 48, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" className={className}>
                <rect width="64" height="64" rx="16" fill="#EFF6FF"/>
                <path d="M32 50L26 58H38L32 50Z" fill="#4B5563"/>
                <rect x="12" y="46" width="40" height="4" rx="2" fill="#1F2937" transform="rotate(-5 32 48)"/>
                <circle cx="16" cy="42" r="6" fill="#EF4444" transform="rotate(-5 32 48)" stroke="white" strokeWidth="2"/>
                <circle cx="48" cy="42" r="6" fill="#10B981" transform="rotate(-5 32 48)" stroke="white" strokeWidth="2"/>
            </svg>
        );

        const MarketUpIcon = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className={className}>
                <circle cx="12" cy="12" r="10" fill="currentColor" fillOpacity="0.15"/>
                <path d="M12 16V8M12 8L8 12M12 8L16 12" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
        );

        const MarketDownIcon = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className={className}>
                <circle cx="12" cy="12" r="10" fill="currentColor" fillOpacity="0.15"/>
                <path d="M12 8V16M12 16L8 12M12 16L16 12" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
        );

        const CheckCircleIcon = ({ size = 18, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
        );

        const WarningIcon = ({ size = 18, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                <line x1="12" y1="9" x2="12" y2="13" />
                <line x1="12" y1="17" x2="12.01" y2="17" />
            </svg>
        );

        const ResetIcon = ({ size = 18, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                <path d="M3 3v5h5" />
                <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" />
                <path d="M16 21h5v-5" />
            </svg>
        );

        const InfoIcon = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10" />
                <line x1="12" y1="16" x2="12" y2="12" />
                <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
        );

        // --- 輔助函數 ---
        const fmt = (num) => new Intl.NumberFormat('zh-TW').format(Math.round(num));

        const calculatePremium = (type, strike, spotPrice) => {
            const distance = type === 'call' ? spotPrice - strike : strike - spotPrice;
            const k = 350000; 
            const price = (distance + Math.sqrt(distance * distance + k)) / 2;
            return Math.round(price);
        };

        const App = () => {
            // 風控條件設定狀態
            const [balanceMin, setBalanceMin] = useState(40);
            const [balanceMax, setBalanceMax] = useState(60);
            const [marginThreshold, setMarginThreshold] = useState(500000);

            const [spotPrice, setSpotPrice] = useState(30000);
            const [totalEquity, setTotalEquity] = useState(5000000); 
            
            const [positions, setPositions] = useState([
                { id: 1, type: 'put', side: 'sell', strike: 29900, quantity: 20, entryPrice: 250 }, 
                { id: 2, type: 'call', side: 'sell', strike: 30100, quantity: 20, entryPrice: 250 }, 
            ]);

            const [logs, setLogs] = useState([]);

            const portfolioStatus = useMemo(() => {
                let callTotalPoints = 0;
                let putTotalPoints = 0;
                let currentMarginUsed = 0;

                const calculatedPositions = positions.map(pos => {
                    const currentPrice = calculatePremium(pos.type, pos.strike, spotPrice);
                    const totalPoints = currentPrice * pos.quantity;
                    const marginPerUnit = 100000; 
                    currentMarginUsed += marginPerUnit * pos.quantity;
                    if (pos.type === 'call') callTotalPoints += totalPoints;
                    if (pos.type === 'put') putTotalPoints += totalPoints;
                    return { ...pos, currentPrice, totalPoints };
                });

                const totalPoints = callTotalPoints + putTotalPoints;
                const balanceRatio = totalPoints === 0 ? 0 : (callTotalPoints / totalPoints) * 100;
                const marginBalance = totalEquity - currentMarginUsed; 

                return { callTotalPoints, putTotalPoints, balanceRatio, calculatedPositions, currentMarginUsed, marginBalance };
            }, [positions, spotPrice, totalEquity]);

            const simulateMarketMove = (delta) => {
                const newPrice = spotPrice + delta;
                setSpotPrice(newPrice);
                addLog(`市場波動: 指數 ${delta > 0 ? '上漲' : '下跌'} ${Math.abs(delta)} 點，目前 ${newPrice}`);
            };

            const executeTrade = (type, strike, quantity, action) => {
                const currentPrem = calculatePremium(type, strike, spotPrice);
                setPositions(prev => {
                    const existingIdx = prev.findIndex(p => p.type === type && p.strike === strike);
                    let newPositions = [...prev];
                    if (action === 'sell') {
                        if (existingIdx >= 0) { newPositions[existingIdx].quantity += quantity; } 
                        else { newPositions.push({ id: Date.now(), type, side: 'sell', strike, quantity, entryPrice: currentPrem }); }
                        addLog(`執行交易: 賣出 ${type.toUpperCase()} ${strike} x ${quantity} 口`);
                    } else {
                        if (existingIdx >= 0) {
                            if (newPositions[existingIdx].quantity >= quantity) {
                                newPositions[existingIdx].quantity -= quantity;
                                if (newPositions[existingIdx].quantity === 0) { newPositions = newPositions.filter((_, idx) => idx !== existingIdx); }
                                addLog(`執行交易: 買回 ${type.toUpperCase()} ${strike} x ${quantity} 口`);
                            }
                        }
                    }
                    return newPositions;
                });
            };

            const addLog = (msg) => {
                setLogs(prev => [{ time: new Date().toLocaleTimeString(), msg }, ...prev].slice(0, 5));
            };

            const resetSimulation = () => {
                setSpotPrice(30000);
                setPositions([
                    { id: 1, type: 'put', side: 'sell', strike: 29900, quantity: 20, entryPrice: 250 },
                    { id: 2, type: 'call', side: 'sell', strike: 30100, quantity: 20, entryPrice: 250 },
                ]);
                setLogs([]);
                addLog("模擬重置：回到初始狀態 (30000點)");
            };

            const getStrategyAdvice = () => {
                const { balanceRatio, marginBalance } = portfolioStatus;
                const hasEnoughBalance = marginBalance >= marginThreshold; 
                if (balanceRatio >= balanceMin && balanceRatio <= balanceMax) {
                    return { status: 'balanced', text: `目前處於平衡狀態 (${balanceMin}% - ${balanceMax}%)`, color: 'text-green-600', bg: 'bg-green-50' };
                }
                if (balanceRatio < balanceMin) {
                    return {
                        status: 'imbalanced-low',
                        text: hasEnoughBalance ? '建議：餘額充足 -> Sell Call' : '建議：餘額不足 -> Buy Put',
                        action: hasEnoughBalance ? 'add_call' : 'reduce_put',
                        color: 'text-red-600',
                        bg: 'bg-red-50'
                    };
                }
                if (balanceRatio > balanceMax) {
                    return {
                        status: 'imbalanced-high',
                        text: hasEnoughBalance ? '建議：餘額充足 -> Sell Put' : '建議：餘額不足 -> Buy Call',
                        action: hasEnoughBalance ? 'add_put' : 'reduce_call',
                        color: 'text-red-600',
                        bg: 'bg-red-50'
                    };
                }
            };

            const advice = getStrategyAdvice();
            const rotationDegree = (50 - portfolioStatus.balanceRatio) * 0.6; 
            const clampedRotation = Math.max(-30, Math.min(30, rotationDegree));
            const marginBalancePercent = Math.max(0, Math.min((portfolioStatus.marginBalance / totalEquity) * 100, 100));

            return (
                <div className="min-h-screen bg-gray-100 p-3 md:p-6 font-sans text-gray-800">
                    <div className="max-w-6xl mx-auto space-y-4 md:space-y-6 border-[6px] border-double border-blue-200 rounded-3xl p-3 md:p-6 bg-white/50 shadow-xl">
                        
                        {/* 標題區 */}
                        <header className="bg-white rounded-xl shadow-sm p-4 md:p-6 flex flex-col lg:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-4">
                                <SeesawLogo size={52} />
                                <div>
                                    <h1 className="text-2xl md:text-3xl font-bold text-gray-900 leading-tight whitespace-nowrap">
                                        雙賣動態平衡策略模擬
                                    </h1>
                                    <p className="text-gray-500 text-sm font-black whitespace-nowrap">
                                        依據權利金、總點數進行動(中性)動態調整
                                    </p>
                                </div>
                            </div>

                            {/* 風控設定 */}
                            <div className="px-6 py-2 border-l-0 lg:border-l-2 border-gray-100 shrink-0">
                                <h3 className="text-sm font-black text-gray-800 mb-2 uppercase tracking-wide whitespace-nowrap">動態風控條件設定：</h3>
                                <div className="flex flex-row items-center gap-4 text-sm whitespace-nowrap">
                                    <div className="flex items-center gap-2 bg-blue-50 p-2.5 rounded-lg border border-blue-100 shadow-sm">
                                        <span className="text-blue-700 font-bold">平衡係數:</span>
                                        <div className="flex items-center gap-1">
                                            <div className="flex items-center bg-white border border-blue-200 rounded shadow-sm focus-within:ring-1 focus-within:ring-blue-400 overflow-hidden">
                                                <input 
                                                    type="number"
                                                    value={balanceMin}
                                                    onChange={(e) => setBalanceMin(parseInt(e.target.value) || 0)}
                                                    className="w-12 px-1 text-center font-mono font-bold outline-none text-base"
                                                />
                                                <span className="text-blue-400 text-xs pr-1.5 font-bold">%</span>
                                            </div>
                                            <span className="font-bold">~</span>
                                            <div className="flex items-center bg-white border border-blue-200 rounded shadow-sm focus-within:ring-1 focus-within:ring-blue-400 overflow-hidden">
                                                <input 
                                                    type="number"
                                                    value={balanceMax}
                                                    onChange={(e) => setBalanceMax(parseInt(e.target.value) || 0)}
                                                    className="w-12 px-1 text-center font-mono font-bold outline-none text-base"
                                                />
                                                <span className="text-blue-400 text-xs pr-1.5 font-bold">%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2 bg-orange-50 p-2.5 rounded-lg border border-orange-100 shadow-sm">
                                        <span className="text-orange-700 font-bold">保證金水位:</span>
                                        {/* 修改點：使用文字輸入並處理格式化，顯示為 500,000 */}
                                        <input 
                                            type="text"
                                            value={fmt(marginThreshold)}
                                            onChange={(e) => {
                                                const val = e.target.value.replace(/,/g, '');
                                                if (!isNaN(val)) setMarginThreshold(parseInt(val) || 0);
                                            }}
                                            className="w-32 bg-white border border-orange-200 rounded px-1.5 text-center font-mono font-bold focus:ring-1 focus:ring-orange-400 outline-none text-base shadow-sm"
                                        />
                                    </div>
                                </div>
                            </div>
                        </header>

                        {/* 核心儀表板 */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            
                            {/* 左側：市場與帳戶狀態 */}
                            <div className="bg-white rounded-xl shadow-sm p-5 space-y-4">
                                <div className="flex justify-between items-center border-b pb-2">
                                    <h2 className="text-sm font-black text-gray-500 uppercase tracking-widest whitespace-nowrap">市場狀態</h2>
                                    <button onClick={resetSimulation} className="flex items-center gap-1.5 px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded-md transition font-black text-gray-600 border border-gray-200 text-xs whitespace-nowrap">
                                        <ResetIcon size={14} /> 重置模擬
                                    </button>
                                </div>
                                
                                <div className="text-center py-4 bg-gray-50 rounded-lg border border-gray-200">
                                    <div className="text-xs text-gray-400 font-bold uppercase tracking-tighter">台指期指數</div>
                                    <div className="text-4xl font-black text-blue-900 tracking-tight leading-none mt-1">{spotPrice}</div>
                                </div>

                                <div className="grid grid-cols-2 gap-2">
                                    <button onClick={() => simulateMarketMove(50)} className="flex flex-col items-center justify-center py-3 bg-red-50 hover:bg-red-100 text-red-700 rounded-lg border border-red-200 transition">
                                        <MarketUpIcon size={24}/><span className="font-black text-xs mt-1 whitespace-nowrap">上漲 50 點</span>
                                    </button>
                                    <button onClick={() => simulateMarketMove(-50)} className="flex flex-col items-center justify-center py-3 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg border border-green-200 transition">
                                        <MarketDownIcon size={24}/><span className="font-black text-xs mt-1 whitespace-nowrap">下跌 50 點</span>
                                    </button>
                                </div>

                                <div className="space-y-3 text-sm mt-4 p-4 bg-gray-50 rounded-xl border border-gray-100 font-bold">
                                    <div className="flex justify-between items-center whitespace-nowrap gap-4">
                                        <span className="text-gray-400 text-base">帳戶總權益:</span>
                                        <span className="font-mono text-gray-800 text-lg tracking-tighter">{fmt(totalEquity)}</span>
                                    </div>
                                    <div className="flex justify-between items-center whitespace-nowrap gap-4">
                                        <span className="text-gray-400 text-base">已用保證金:</span>
                                        <span className="font-mono text-orange-600 text-lg tracking-tighter">{fmt(portfolioStatus.currentMarginUsed)}</span>
                                    </div>
                                    <div className="flex justify-between items-center border-t border-gray-200 pt-2.5 mt-1 font-black whitespace-nowrap gap-4">
                                        <span className="text-gray-700 text-base">保證金餘額:</span>
                                        <span className={`font-mono text-lg ${portfolioStatus.marginBalance < marginThreshold ? 'text-red-600' : 'text-blue-700'}`}>
                                            {fmt(portfolioStatus.marginBalance)}
                                        </span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-3 mt-2 shadow-inner overflow-hidden">
                                        <div 
                                            className={`h-full transition-all duration-500 ${portfolioStatus.marginBalance < marginThreshold ? 'bg-red-500' : 'bg-orange-500'}`} 
                                            style={{ width: `${marginBalancePercent}%` }}
                                        ></div>
                                    </div>
                                </div>

                                <div className={`p-4 rounded-xl border-2 border-dashed transition-all duration-300 text-center ${advice.status === 'balanced' ? 'border-green-300 bg-green-50' : 'border-red-300 bg-red-50'}`}>
                                    <div className={`font-black text-base ${advice.color}`}>{advice.text}</div>
                                    {advice.action && (
                                        <div className="flex justify-center mt-3">
                                            {advice.action === 'add_call' && <button onClick={() => executeTrade('call', spotPrice + 100, 1, 'sell')} className="px-4 py-1.5 bg-green-600 text-white rounded-lg text-xs font-black hover:bg-green-700 shadow whitespace-nowrap">Sell Call (執行建議)</button>}
                                            {advice.action === 'reduce_put' && <button onClick={() => executeTrade('put', positions.find(p => p.type === 'put')?.strike || 29900, 1, 'buy')} className="px-4 py-1.5 bg-red-600 text-white rounded-lg text-xs font-black hover:bg-red-700 shadow whitespace-nowrap">Buy Put (執行建議)</button>}
                                            {advice.action === 'add_put' && <button onClick={() => executeTrade('put', spotPrice - 100, 1, 'sell')} className="px-4 py-1.5 bg-green-600 text-white rounded-lg text-xs font-black hover:bg-green-700 shadow whitespace-nowrap">Sell Put (執行建議)</button>}
                                            {advice.action === 'reduce_call' && <button onClick={() => executeTrade('call', positions.find(p => p.type === 'call')?.strike || 30100, 1, 'buy')} className="px-4 py-1.5 bg-red-600 text-white rounded-lg text-xs font-black hover:bg-red-700 shadow whitespace-nowrap">Buy Call (執行建議)</button>}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* 中間：動態平衡監控 */}
                            <div className="md:col-span-2 bg-white rounded-xl shadow-sm p-6 flex flex-col">
                                <h2 className="text-sm font-black text-gray-500 border-b pb-2 mb-6 flex items-center justify-between uppercase tracking-widest">
                                    <span>動態平衡監控</span>
                                    <span className={`text-xs px-2.5 py-1 rounded font-black flex items-center gap-1.5 ${advice.status === 'balanced' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} whitespace-nowrap`}>
                                        {advice.status === 'balanced' ? <CheckCircleIcon size={16}/> : <WarningIcon size={16}/>}
                                        {advice.status === 'balanced' ? '平衡' : '失衡'}
                                    </span>
                                </h2>

                                <div className="flex items-end justify-between px-6 mb-6 font-black">
                                    <div className="text-center w-1/3">
                                        <div className="text-3xl text-red-600 leading-none font-black">{fmt(portfolioStatus.callTotalPoints)}</div>
                                        <div className="text-sm text-gray-400 mt-1.5 font-bold whitespace-nowrap">Call 總點數</div>
                                    </div>
                                    <div className="text-center w-1/3 pb-1">
                                        <div className="text-5xl text-purple-700 tracking-tighter leading-none font-black">{portfolioStatus.balanceRatio.toFixed(1)}%</div>
                                        <div className="text-[11px] text-gray-400 tracking-tight uppercase font-bold mt-2 whitespace-nowrap">Call / (Call + Put)</div>
                                    </div>
                                    <div className="text-center w-1/3">
                                        <div className="text-3xl text-green-600 leading-none font-black">{fmt(portfolioStatus.putTotalPoints)}</div>
                                        <div className="text-sm text-gray-400 mt-1.5 font-bold whitespace-nowrap">Put 總點數</div>
                                    </div>
                                </div>

                                <div className="relative w-full h-36 flex justify-center items-end overflow-hidden pb-6">
                                    <div className="absolute bottom-6 w-0 h-0 border-l-[18px] border-l-transparent border-r-[18px] border-r-transparent border-b-[40px] border-b-gray-600 z-10 flex justify-center">
                                        <div className="absolute top-[20px] w-3 h-3 bg-gray-300 rounded-full border border-gray-500 shadow-inner"></div>
                                    </div>
                                    <div className="w-3/4 h-3 wood-texture rounded-full shadow-lg relative transition-transform duration-700 ease-out border-b-2 border-amber-900" style={{ transform: `rotate(${clampedRotation}deg)`, transformOrigin: 'center bottom', marginBottom: '35px' }}>
                                        <div className="absolute -top-12 left-6 flex flex-col items-center">
                                            <div className="w-16 h-12 bg-gradient-to-b from-red-400 to-red-600 rounded-lg shadow-md border-b-2 border-red-800 flex items-center justify-center text-white font-black text-xs z-20 uppercase">Call</div>
                                            <div className="w-12 h-0.5 bg-black/20 blur-sm rounded-full mt-1"></div>
                                        </div>
                                        <div className="absolute -top-12 right-6 flex flex-col items-center">
                                            <div className="w-16 h-12 bg-gradient-to-b from-green-400 to-green-600 rounded-lg shadow-md border-b-2 border-green-800 flex items-center justify-center text-white font-black text-xs z-20 uppercase">Put</div>
                                            <div className="w-12 h-0.5 bg-black/20 blur-sm rounded-full mt-1"></div>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex justify-between text-[11px] text-gray-400 -mt-1 px-10 mb-6 font-black tracking-widest uppercase whitespace-nowrap">
                                    <span>Call 重 (&gt; {balanceMax}%)</span>
                                    <span>平衡 (50%)</span>
                                    <span>Put 重 (&lt; {balanceMin}%)</span>
                                </div>

                                <div className="mt-4 border-t border-gray-100 pt-6 font-black">
                                    <h3 className="text-base text-gray-700 mb-4 underline decoration-blue-200 decoration-2 underline-offset-8 tracking-tight uppercase whitespace-nowrap">當前倉位明細 (目前持倉)</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left">
                                            <thead className="text-[11px] text-gray-400 uppercase bg-gray-50/50 font-black border-b border-gray-100">
                                                <tr>
                                                    <th className="px-3 py-2.5 whitespace-nowrap">類型</th>
                                                    <th className="px-3 py-2.5 whitespace-nowrap">履約價</th>
                                                    <th className="px-3 py-2.5 whitespace-nowrap">口數</th>
                                                    <th className="px-3 py-2.5 whitespace-nowrap text-orange-600">權利金</th>
                                                    <th className="px-3 py-2.5 whitespace-nowrap">總點數</th>
                                                    <th className="px-3 py-2.5 whitespace-nowrap text-center">調整</th>
                                                </tr>
                                            </thead>
                                            <tbody className="font-bold">
                                                {portfolioStatus.calculatedPositions.map((pos) => (
                                                    <tr key={pos.id} className="bg-white border-b border-gray-50 hover:bg-blue-50/20 transition">
                                                        <td className={`px-3 py-2.5 font-black text-base whitespace-nowrap ${pos.type === 'call' ? 'text-red-600' : 'text-green-600'}`}>Sell {pos.type.toUpperCase()}</td>
                                                        <td className="px-3 py-2.5 font-mono text-base whitespace-nowrap">{pos.strike}</td>
                                                        <td className="px-3 py-2.5 font-mono text-base whitespace-nowrap">{pos.quantity}</td>
                                                        <td className="px-3 py-2.5 text-gray-400 font-mono text-base whitespace-nowrap">{pos.currentPrice}</td>
                                                        <td className="px-3 py-2.5 font-black text-gray-900 font-mono text-lg whitespace-nowrap">{fmt(pos.totalPoints)}</td>
                                                        <td className="px-3 py-2.5 text-center whitespace-nowrap">
                                                            <div className="flex gap-2 justify-center">
                                                                <button onClick={() => executeTrade(pos.type, pos.strike, 1, 'sell')} className="w-8 h-8 bg-green-100 text-green-700 hover:bg-green-200 border border-green-300 rounded text-lg font-black transition flex items-center justify-center shadow-sm">+</button>
                                                                <button onClick={() => executeTrade(pos.type, pos.strike, 1, 'buy')} className="w-8 h-8 bg-red-100 text-red-700 hover:bg-red-200 border border-red-300 rounded text-lg font-black transition flex items-center justify-center shadow-sm">-</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* 底部：操作面板與紀錄 */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 font-black">
                            <div className="bg-white rounded-xl shadow-sm p-5 flex flex-col">
                                <h2 className="text-base font-black text-gray-400 border-b pb-2 mb-5 uppercase tracking-widest whitespace-nowrap">建議與自定義調整</h2>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="border border-red-100 rounded-xl p-4 bg-red-50/50">
                                        <h4 className="text-red-800 text-sm mb-2.5 text-center uppercase tracking-widest font-black whitespace-nowrap">CALL (左側重量)</h4>
                                        <div className="flex gap-2">
                                            <button onClick={() => executeTrade('call', spotPrice + 100, 1, 'sell')} className="flex-1 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-black shadow transition-all active:scale-95 whitespace-nowrap">Sell Call</button>
                                            <button onClick={() => executeTrade('call', positions.find(p => p.type === 'call')?.strike || 30100, 1, 'buy')} className="flex-1 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-black shadow transition-all active:scale-95 whitespace-nowrap">Buy Call</button>
                                        </div>
                                    </div>
                                    <div className="border border-green-100 rounded-xl p-4 bg-green-50/50">
                                        <h4 className="text-green-800 text-sm mb-2.5 text-center uppercase tracking-widest font-black whitespace-nowrap">PUT (右側重量)</h4>
                                        <div className="flex gap-2">
                                            <button onClick={() => executeTrade('put', spotPrice - 100, 1, 'sell')} className="flex-1 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-black shadow transition-all active:scale-95 whitespace-nowrap">Sell Put</button>
                                            <button onClick={() => executeTrade('put', positions.find(p => p.type === 'put')?.strike || 29900, 1, 'buy')} className="flex-1 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-black shadow transition-all active:scale-95 whitespace-nowrap">Buy Put</button>
                                        </div>
                                    </div>
                                </div>
                                <p className="text-[11px] text-gray-300 mt-4 text-center italic font-bold whitespace-nowrap uppercase">提示：此區按鈕每次點擊增減 1 口</p>
                            </div>

                            <div className="bg-white rounded-xl shadow-sm p-5 flex flex-col">
                                <h2 className="text-base font-black text-gray-400 border-b pb-2 mb-5 uppercase tracking-widest whitespace-nowrap">操作紀錄</h2>
                                <div className="flex-1 bg-gray-50 rounded-lg border border-gray-100 p-4 overflow-y-auto max-h-40 shadow-inner">
                                    {logs.length === 0 && <p className="text-gray-400 text-center mt-5 italic font-medium text-base">尚無操作紀錄</p>}
                                    <ul className="space-y-2 font-bold">
                                        {logs.map((log, index) => (
                                            <li key={index} className="text-[13px] text-gray-500 flex gap-2.5 items-start border-b border-gray-200/50 pb-1.5 last:border-0">
                                                <span className="text-gray-400 font-mono tracking-tighter shrink-0 opacity-70 whitespace-nowrap">[{log.time}]</span>
                                                <span className="font-bold leading-tight">{log.msg}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        {/* 底部說明區塊 */}
                        <div className="bg-blue-50/80 border border-blue-100 rounded-2xl p-6 text-sm text-blue-900 flex flex-col md:flex-row gap-5 shadow-sm font-black">
                            <InfoIcon className="shrink-0 text-blue-400" size={28} />
                            <div>
                                <h4 className="text-[13px] mb-2.5 text-blue-900 font-black uppercase tracking-widest border-b border-blue-200 inline-block pb-0.5 whitespace-nowrap">關於動態平衡邏輯</h4>
                                <div className="leading-relaxed space-y-2.5 opacity-90 text-[13px]">
                                    <p className="flex items-center gap-2.5">
                                        <span className="w-2 h-2 bg-blue-400 rounded-full shrink-0"></span>
                                        核心公式：<code className="bg-white/50 px-2 py-0.5 rounded font-mono font-black text-blue-800 text-xs shadow-sm tracking-tighter whitespace-nowrap">平衡比例 = Call總點數 / (Call總點數 + Put總點數)</code>
                                    </p>
                                    <p className="flex items-center gap-2.5">
                                        <span className="w-2 h-2 bg-blue-400 rounded-full shrink-0"></span>
                                        目標是將比例維持在 <strong>50%</strong> 左右 (蹺蹺板水平)，達到權利金中性。
                                    </p>
                                    <p className="flex items-start gap-2.5">
                                        <span className="w-2 h-2 bg-blue-400 rounded-full mt-2 shrink-0"></span>
                                        <span className="leading-snug">當市場 <strong>下跌</strong> (Call變輕/Put變重)，蹺蹺板向右傾斜。若資金足夠，應 <strong>Sell Call</strong> (增加左側重量) 來拉回平衡。</span>
                                    </p>
                                    <p className="flex items-start gap-2.5">
                                        <span className="w-2 h-2 bg-blue-400 rounded-full mt-2 shrink-0"></span>
                                        <span className="leading-snug">當市場 <strong>上漲</strong> (Call變重/Put變輕)，蹺蹺板向左傾斜。若資金足夠，應 <strong>Sell Put</strong> (增加右側重量)。</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>