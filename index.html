<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­å¤§é¸æ“‡æ¬Šæ•™å®¤éš¨å ‚æ¸¬é©—</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas for saving as image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700;900&display=swap');
        
        body { 
            background-color: #f4f4f2; 
            font-family: 'Noto Serif TC', serif; 
            margin: 0; 
            padding: 0; 
            min-height: 100vh; 
            overflow-x: hidden;
        }

        /* è­‰æ›¸å¤–æ¡†æ¶ï¼šå›ºå®š A4 æ¯”ä¾‹ 700x990 */
        .certificate-outer {
            padding: 0;
            background: #ffffff;
            box-shadow: 0 40px 80px rgba(0,0,0,0.1);
            border-radius: 2px;
            width: 700px;
            height: 990px;
            margin: 0 auto;
            position: relative;
            box-sizing: border-box;
            display: block;
            flex-shrink: 0;
        }
        
        /* æ¨¡æ“¬äºéº»ç´™å¼µè³ªæ„Ÿ (æ¯›æ¯›çš„æ„Ÿè¦º) */
        .certificate-container {
            background-color: #fdf8f1; 
            background-image: 
                repeating-linear-gradient(rgba(0,0,0,0.015) 0px, rgba(0,0,0,0.015) 1px, transparent 1px, transparent 3px),
                repeating-linear-gradient(90deg, rgba(0,0,0,0.015) 0px, rgba(0,0,0,0.015) 1px, transparent 1px, transparent 3px);
            border: 3.5px solid #a37b45;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }

        /* Joption å…¨ç•«é¢é‡è¤‡æµ®æ°´å° */
        .watermark-overlay {
            position: absolute;
            inset: 0;
            z-index: 1;
            pointer-events: none;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg width='160' height='80' viewBox='0 0 160 80' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='50%25' y='50%25' font-family='Arial, sans-serif' font-weight='900' font-size='12' fill='%23a37b45' text-anchor='middle' dominant-baseline='middle' transform='rotate(-25 80 40)'%3EJOPTION%3C/text%3E%3C/svg%3E");
            background-repeat: repeat;
        }

        /* é›™ç·šå…§é‚Šæ¡† */
        .certificate-inner-border {
            border: 1px solid #dcd0b9;
            margin: 12px;
            height: calc(100% - 24px);
            position: relative;
            z-index: 2;
            box-sizing: border-box;
            padding: 0;
        }
        
        .no-wrap { white-space: nowrap; }

        /* å§“ååº•ç·š */
        .name-underline {
            width: 350px;
            height: 1.5px;
            background-color: #e5e7eb;
            margin: 8px auto 0;
        }

        /* å‹³ç« ç‰¹æ•ˆ */
        .glow-purple { filter: drop-shadow(0 0 12px rgba(167, 139, 250, 0.6)); animation: pulseGlow 2.5s infinite; }
        .glow-gold { filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.3)); }
        @keyframes pulseGlow { 0%, 100% { transform: scale(1); opacity: 0.9; } 50% { transform: scale(1.03); opacity: 1; } }

        /* æ‰‹æ©Ÿç«¯é è¦½ç¸®æ”¾ (ä¸å½±éŸ¿æˆªåœ–) */
        @media screen and (max-width: 768px) {
            .certificate-preview-scroll {
                width: 100%;
                overflow-x: auto;
                padding: 20px 0;
                -webkit-overflow-scrolling: touch;
            }
            .certificate-outer {
                transform: scale(0.5);
                transform-origin: top left;
                margin-left: calc(50vw - 175px); /* å±…ä¸­æ ¡æº– */
                margin-bottom: -450px;
            }
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            backdrop-filter: blur(8px);
        }

        .btn-ghibli {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 99px;
        }
        .btn-ghibli:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CONFIG = {
            formActionUrl: "https://docs.google.com/forms/d/e/1FAIpQLSeoBO2Dumc6wTJ32dvoMhe-cfcaBh46DOWCb4EUl9XDPMvLmw/formResponse",
            nameEntryId: "entry.763113619",
            scoreEntryId: "entry.236333802",
            emailEntryId: "emailAddress", 
            SHEET_CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSVeIf30C4q_dI4RAoaNHjItk0F35QdtIvizSyJWbbNfnVxhYj-NyWocq67QknUEFr1_0oBvgJntMbi/pub?output=csv" 
        };

        const Trophy = () => (<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>);
        const Home = () => (<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>);
        const Download = () => (<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>);
        const Loader = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`animate-spin ${className}`}><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg>);
        const X = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>);

        function App() {
            const [view, setView] = useState('home');
            const [playerName, setPlayerName] = useState('');
            const [playerEmail, setPlayerEmail] = useState('');
            const [currentQuestions, setCurrentQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [answers, setAnswers] = useState([]);
            const [score, setScore] = useState(0);
            const [submitStatus, setSubmitStatus] = useState('idle');
            const [leaderboard, setLeaderboard] = useState([]);
            const [isLoadingLeaderboard, setIsLoadingLeaderboard] = useState(false);
            const [errorMessage, setErrorMessage] = useState('');
            const [isSaving, setIsSaving] = useState(false);
            const [savedImage, setSavedImage] = useState(null);

            const formRef = useRef(null);
            const certificateRef = useRef(null);

            const getRankInfo = (s) => {
                if (s === 100) return { title: "æ¬Šåˆ©é‡‘ä¹‹ç¥", icon: "ğŸŸ£ğŸ‘‘", color: "text-purple-600", glow: "glow-purple" };
                if (s >= 95) return { title: "ç­–ç•¥æŒ‡æ®å®˜", icon: "âš«â™Ÿï¸", color: "text-stone-900", glow: "glow-gold" };
                if (s >= 90) return { title: "è³£æ–¹æ“ç›¤æ‰‹", icon: "âš«ğŸ“Š", color: "text-stone-800", glow: "" };
                if (s >= 85) return { title: "é¢¨éšªæ§ç®¡å°ˆå“¡", icon: "ğŸŸ¡ğŸ›¡ï¸", color: "text-amber-800", glow: "" };
                if (s >= 80) return { title: "ç­–ç•¥å¯¦ç¿’ç”Ÿ", icon: "ğŸŸ¡âš–ï¸", color: "text-amber-700", glow: "" };
                if (s >= 75) return { title: "æ³¢å‹•ç‡è§€å¯Ÿå“¡", icon: "âšªğŸ“ˆ", color: "text-slate-600", glow: "" };
                if (s >= 70) return { title: "æ™‚é–“åƒ¹å€¼æ¢ç´¢è€…", icon: "âšªâ³", color: "text-slate-500", glow: "" };
                if (s >= 65) return { title: "å±¥ç´„åƒ¹æ–°å…µ", icon: "ğŸŸ¤ğŸ¯", color: "text-orange-900", glow: "" };
                if (s >= 60) return { title: "æ¬Šåˆ©é‡‘å­¸å¾’", icon: "ğŸŸ¤ğŸ’°", color: "text-orange-800", glow: "" };
                return { title: "é¸æ“‡æ¬Šå°ç™½", icon: "ğŸ”°â“", color: "text-stone-400", glow: "" };
            };

            const parseCSV = (text) => {
                const lines = text.split(/\r?\n/).filter(line => line.trim() !== "");
                if (lines.length < 2) return [];
                const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
                let nameIdx = headers.findIndex(h => h.includes("å§“å") || h.includes("åç¨±"));
                let scoreIdx = headers.findIndex(h => h.includes("åˆ†æ•¸") || h.includes("æˆç¸¾"));
                if (nameIdx === -1) nameIdx = 2; if (scoreIdx === -1) scoreIdx = 3;
                return lines.slice(1).map(line => {
                    const cols = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
                    const cleanCols = cols.map(c => c.replace(/^"|"$/g, '').trim());
                    return { name: cleanCols[nameIdx] || "åŒ¿åç©å®¶", score: parseInt(cleanCols[scoreIdx]) || 0, date: cleanCols[0]?.split(' ')[0] || '' };
                }).filter(item => item.name && !item.name.includes("å§“å"));
            };

            const fetchLeaderboard = async () => {
                setIsLoadingLeaderboard(true);
                try {
                    const url = `${CONFIG.SHEET_CSV_URL}&t=${Date.now()}`;
                    const response = await fetch(url, { cache: 'no-store' });
                    const text = await response.text();
                    setLeaderboard(parseCSV(text).sort((a, b) => b.score - a.score));
                } catch (e) { console.error(e); } finally { setIsLoadingLeaderboard(false); }
            };

            const startQuiz = () => {
                if (!playerName.trim()) return setErrorMessage("è«‹è¼¸å…¥å†’éšªè€…åç¨±");
                setErrorMessage('');
                const qBank = [
                    { q: "é—œæ–¼é¸æ“‡æ¬Šï¼Œè²·æ–¹ï¼ˆBuyï¼‰èˆ‡è³£æ–¹ï¼ˆSellï¼‰çš„é¢¨éšªæ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ", a: ["è²·æ–¹é¢¨éšªæœ‰é™ï¼Œè³£æ–¹é¢¨éšªç„¡é™", "è³£æ–¹é¢¨éšªæœ‰é™ï¼Œè²·æ–¹é¢¨éšªç„¡é™", "å…©è€…é¢¨éšªçš†ç‚ºç„¡é™", "å…©è€…é¢¨éšªçš†ç‚ºæœ‰é™"], correct: 0 },
                    { q: "ç•¶ä½ é æœŸæœªä¾†è¡Œæƒ…æœƒã€Œå¤§æ¼²ã€ï¼Œæœ€é©åˆçš„ç°¡å–®ç­–ç•¥æ˜¯ï¼Ÿ", a: ["Buy Put", "Sell Call", "Buy Call", "Sell Put"], correct: 2 },
                    { q: "å°æŒ‡é¸æ“‡æ¬Šä¸­ï¼Œæ‰€è¬‚çš„ã€Œé€±é¸æ“‡æ¬Šã€é€šå¸¸åœ¨æ¯é€±å¹¾é€²è¡Œçµç®—ï¼Ÿ", a: ["é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±äº”"], correct: 2 },
                    { q: "æ­å¤§å¸¸æåˆ°çš„ã€Œè³£å‡ºå‹’å¼ç­–ç•¥ã€æ˜¯æŒ‡åŒæ™‚åšä»€éº¼å‹•ä½œï¼Ÿ", a: ["è²·é€² Callï¼Œè²·é€² Put", "è³£å‡ºä¸åŒå±¥ç´„åƒ¹çš„ Call èˆ‡ Put", "è³£å‡º Callï¼Œè²·é€² Put", "è²·é€² Callï¼Œè³£å‡º Put"], correct: 1 },
                    { q: "åœ¨æœŸæ¬Šäº¤æ˜“ä¸­ï¼Œã€Œæ™‚é–“åƒ¹å€¼ã€çš„æµé€ï¼ˆThetaï¼‰å°å“ªä¸€æ–¹æœ€æœ‰åˆ©ï¼Ÿ", a: ["è²·æ–¹", "è³£æ–¹", "è­‰åˆ¸å•†", "æœŸäº¤æ‰€"], correct: 1 }
                ];
                setCurrentQuestions([...qBank].sort(() => 0.5 - Math.random()));
                setCurrentIndex(0); setAnswers([]); setScore(0); setSubmitStatus('idle'); setView('quiz');
            };

            const handleAnswer = (idx) => {
                const newAnswers = [...answers, idx]; setAnswers(newAnswers);
                if (currentIndex < 4) { setCurrentIndex(currentIndex + 1); } 
                else {
                    let s = 0; currentQuestions.forEach((q, i) => { if (q.correct === newAnswers[i]) s += 20; });
                    setScore(s); setView('result');
                    setTimeout(() => { if (formRef.current) { formRef.current.submit(); setSubmitStatus('success'); fetchLeaderboard(); } }, 800);
                }
            };

            const saveAsImage = async () => {
                if (!certificateRef.current || isSaving) return;
                setIsSaving(true);
                try {
                    // å¼·åˆ¶æ“·å–è¨­å®šç‚º 700x990
                    const canvas = await html2canvas(certificateRef.current, {
                        scale: 2.5,
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: "#fdf8f1",
                        width: 700,
                        height: 990,
                        onclone: (clonedDoc) => {
                            const clonedOuter = clonedDoc.querySelector('.certificate-outer');
                            if (clonedOuter) {
                                clonedOuter.style.transform = 'none';
                                clonedOuter.style.boxShadow = 'none';
                                clonedOuter.style.margin = '0';
                                clonedOuter.style.width = '700px';
                                clonedOuter.style.height = '990px';
                            }
                        }
                    });
                    const dataUrl = canvas.toDataURL("image/png", 1.0);
                    setSavedImage(dataUrl);
                    const link = document.createElement('a');
                    link.download = `æ­å¤§é¸æ“‡æ¬Šæ•™å®¤_çµæ¥­è­‰æ›¸_${playerName}.png`;
                    link.href = dataUrl;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (err) { alert("åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼Œå»ºè­°ä½¿ç”¨è¢å¹•æˆªåœ–ã€‚"); } finally { setIsSaving(false); }
            };

            const rank = getRankInfo(score);

            return (
                <div className="min-h-screen p-4 flex flex-col items-center justify-center relative bg-[#f4f4f2]">
                    <div style={{ display: 'none' }}>
                        <iframe name="hidden_iframe"></iframe>
                        <form ref={formRef} action={CONFIG.formActionUrl} method="POST" target="hidden_iframe">
                            <input type="hidden" name={CONFIG.nameEntryId} value={playerName} />
                            <input type="hidden" name={CONFIG.scoreEntryId} value={score} />
                            <input type="hidden" name={CONFIG.emailEntryId} value={playerEmail} />
                        </form>
                    </div>

                    <div className="relative w-full max-w-lg z-10 py-4">
                        
                        {view === 'home' && (
                            <div className="bg-white/90 backdrop-blur-md p-10 rounded-[30px] shadow-2xl border-4 border-white text-center fade-in">
                                <div className="mb-8"><img src="IPæ¨™ç±¤.jpg" alt="Logo" className="w-32 h-auto mx-auto border-4 border-white shadow-lg rounded-2xl" /></div>
                                <h1 className="text-3xl font-bold text-stone-900 mb-2">æ­å¤§é¸æ“‡æ¬Šæ•™å®¤</h1>
                                <p className="text-stone-500 mb-10 italic">éš¨å ‚æ¸¬é©— â€” æ¸¬é©—ä½ çš„æœŸæ¬Šå¯¦åŠ›</p>
                                <div className="space-y-4 mb-8">
                                    <input type="text" placeholder="æ‚¨çš„å§“åï¼Œä¾‹å¦‚ï¼šæ­å¤§" className="w-full px-6 py-4 rounded-full border-2 border-stone-100 focus:border-amber-400 focus:outline-none text-lg bg-stone-50/50" value={playerName} onChange={(e) => setPlayerName(e.target.value)} />
                                    <input type="email" placeholder="é›»å­ä¿¡ç®±ï¼Œä¾‹å¦‚ï¼šJoption@gmail.com" className="w-full px-6 py-4 rounded-full border-2 border-stone-100 focus:border-amber-400 focus:outline-none text-lg bg-stone-50/50" value={playerEmail} onChange={(e) => setPlayerEmail(e.target.value)} />
                                    {errorMessage && <p className="text-red-500 text-sm font-bold text-center mt-2">{errorMessage}</p>}
                                </div>
                                <div className="space-y-3 px-2">
                                    <button onClick={startQuiz} className="btn-ghibli w-full bg-[#8baeb2] hover:bg-[#6c8f93] text-white font-bold py-4 shadow-lg text-xl transition-all">é–‹å§‹ä½œç­”</button>
                                    <button onClick={() => { setView('leaderboard'); fetchLeaderboard(); }} className="btn-ghibli w-full bg-white text-stone-500 border-2 border-stone-100 font-semibold py-4 hover:bg-stone-50 transition-all">è§€çœ‹æ’è¡Œæ¦œ</button>
                                </div>
                            </div>
                        )}

                        {view === 'quiz' && (
                            <div className="bg-white p-8 rounded-[30px] shadow-xl border-4 border-white fade-in">
                                <div className="flex justify-between items-center mb-10 text-stone-400 font-bold text-[10px] tracking-widest uppercase">
                                    <span>é€²åº¦ {currentIndex + 1} / 5</span>
                                    <div className="w-32 h-1.5 bg-stone-100 rounded-full overflow-hidden"><div className="h-full bg-[#8baeb2] transition-all duration-500" style={{ width: `${((currentIndex + 1) / 5) * 100}%` }}></div></div>
                                </div>
                                <h2 className="text-2xl font-bold mb-10 min-h-[5rem] leading-relaxed text-stone-800">{currentQuestions[currentIndex]?.q}</h2>
                                <div className="space-y-4">
                                    {currentQuestions[currentIndex]?.a.map((opt, i) => (
                                        <button key={i} onClick={() => handleAnswer(i)} className="w-full text-left p-6 border-2 border-stone-50 hover:border-[#8baeb2] hover:bg-[#8baeb2]/5 rounded-3xl group flex items-center transition-all">
                                            <span className="w-10 h-10 flex items-center justify-center bg-stone-50 group-hover:bg-[#8baeb2] group-hover:text-white rounded-full mr-4 text-xs font-bold border border-stone-100">{String.fromCharCode(65 + i)}</span>{opt}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'result' && (
                            <div className="space-y-6 fade-in flex flex-col items-center">
                                <div className="certificate-preview-scroll">
                                    <div className="certificate-outer" ref={certificateRef}>
                                        <div className="certificate-container">
                                            <div className="watermark-overlay"></div>
                                            <div className="certificate-inner-border">
                                                
                                                {/* 1. Logo (å›ºå®šä½ç½®) */}
                                                <div style={{ marginTop: '70px', marginBottom: '40px' }} className="text-center">
                                                    <img src="IPæ¨™ç±¤.jpg" alt="Logo" className="w-20 h-auto mx-auto border border-stone-200" />
                                                </div>

                                                {/* 2. æ¨™é¡Œèˆ‡ç« ç¯€ */}
                                                <div style={{ marginBottom: '50px' }} className="text-center">
                                                    <h1 className="text-6xl font-black text-stone-800 tracking-[0.15em] no-wrap">çµæ¥­è­‰æ›¸</h1>
                                                    <p className="text-stone-400 text-sm mt-3 tracking-[0.3em] font-bold uppercase no-wrap">Chap 1 é¸æ“‡æ¬Šé‚è¼¯å…¥é–€</p>
                                                </div>

                                                {/* 3. èŒ²è­‰æ˜ */}
                                                <div style={{ marginBottom: '30px' }} className="text-center">
                                                    <p className="text-stone-500 text-xl italic">èŒ²è­‰æ˜</p>
                                                </div>

                                                {/* 4. å§“å */}
                                                <div style={{ marginBottom: '60px' }} className="text-center">
                                                    <h2 className="text-5xl font-black text-stone-900 no-wrap">{playerName}</h2>
                                                    <div className="name-underline"></div>
                                                </div>

                                                {/* 5. åƒèˆ‡æ¸¬é©— */}
                                                <div style={{ marginBottom: '40px' }} className="text-center">
                                                    <p className="text-stone-600 text-lg">åƒèˆ‡éš¨å ‚æ¸¬é©—ï¼Œç²å¾—æˆç¸¾ï¼š</p>
                                                </div>

                                                {/* 6. åˆ†æ•¸èˆ‡éšç´š */}
                                                <div style={{ marginBottom: '60px' }} className="flex items-center justify-center gap-20">
                                                    <div className="text-center">
                                                        <span className="text-[10px] text-stone-300 font-bold block mb-2 uppercase tracking-widest">åˆ†æ•¸</span>
                                                        <span className="text-8xl font-black text-amber-800">{score}</span>
                                                    </div>
                                                    <div className="text-center">
                                                        <span className="text-[10px] text-stone-300 font-bold block mb-2 uppercase tracking-widest">æˆäºˆéšç´š</span>
                                                        <div className="flex flex-col items-center">
                                                            <span className={`text-6xl mb-2 ${rank.glow}`}>{rank.icon}</span>
                                                            <span className={`text-2xl font-black ${rank.color} no-wrap`}>{rank.title}</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* 7. çµèª */}
                                                <div style={{ marginBottom: '50px' }} className="max-w-sm mx-auto text-center px-10">
                                                    <p className="text-stone-400 text-sm leading-loose tracking-wide">
                                                        å…·å‚™åˆéšé¸æ“‡æ¬Šé¢¨éšªè­˜åˆ¥èˆ‡<br/>
                                                        åŸºæœ¬ç­–ç•¥é‹ç”¨èƒ½åŠ›ï¼Œç‰¹ç™¼æ­¤è­‰ã€‚
                                                    </p>
                                                </div>

                                                {/* 8. ç°½ç«  (åº•éƒ¨ç²¾ç¢ºå°é½Š) */}
                                                <div style={{ position: 'absolute', bottom: '50px', left: '50px', right: '50px' }} className="flex justify-between items-end">
                                                    <div className="text-left text-[9px] text-stone-400 font-sans leading-relaxed uppercase">
                                                        DATE: {new Date().toLocaleDateString('zh-TW')}<br/>
                                                        NO: JOPT-ID-{Math.floor(Date.now()/1000)}
                                                    </div>
                                                    <div className="relative flex items-center pr-4">
                                                        <span className="text-stone-900 text-3xl font-black italic mr-3 no-wrap">é™¢é•· æ­å¤§</span>
                                                        <div className="w-20 h-20 border-2 border-red-600/40 rounded-full flex items-center justify-center text-red-600/50 font-bold rotate-12 absolute -top-8 -right-10 text-[9px] leading-tight text-center">
                                                            æ­å¤§<br/>é¸æ“‡æ¬Š
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="w-full max-w-lg grid grid-cols-1 gap-4 px-2 pt-10">
                                    <button onClick={() => { setView('leaderboard'); fetchLeaderboard(); }} className="btn-ghibli w-full bg-[#8baeb2] text-white py-4 rounded-full font-bold shadow-lg text-lg flex items-center justify-center gap-2"><Trophy /> è§€çœ‹å³æ™‚æ’è¡Œæ¦œ</button>
                                    <div className="flex gap-4">
                                        <button onClick={saveAsImage} disabled={isSaving} className="btn-ghibli flex-1 bg-stone-900 text-white py-4 rounded-full font-bold shadow hover:bg-black transition-all text-base flex items-center justify-center gap-2">
                                            {isSaving ? <Loader className="w-4 h-4 text-white" /> : <><Download className="w-4 h-4"/> å„²å­˜çµæ¥­è­‰æ›¸</>}
                                        </button>
                                        <button onClick={() => setView('home')} className="btn-ghibli flex-1 bg-white text-stone-400 border-2 border-stone-100 py-4 rounded-full font-bold hover:bg-stone-50 transition-all text-base">è¿”å›æŒ‘æˆ°</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'leaderboard' && (
                            <div className="bg-white/95 backdrop-blur-md p-10 rounded-[40px] max-h-[85vh] flex flex-col shadow-2xl border-4 border-white fade-in mx-auto max-w-md">
                                <div className="flex justify-between items-center mb-8 border-b border-stone-100 pb-6">
                                    <h2 className="text-xl font-bold text-stone-900 tracking-widest text-center no-wrap">å·”å³°æŒ‘æˆ°è³½æ¦œå–®</h2>
                                    <button onClick={() => setView('home')} className="p-2 text-stone-300 hover:text-stone-800 transition-colors"><Home /></button>
                                </div>
                                <div className="overflow-y-auto flex-1 space-y-3 pr-2 scrollbar-thin text-left">
                                    {isLoadingLeaderboard ? (
                                        <div className="text-center py-24 text-stone-300 flex flex-col items-center gap-4"><Loader className="w-8 h-8 text-stone-300" /><p className="text-[10px] tracking-widest uppercase text-center font-bold">è®€å–ä¸­...</p></div>
                                    ) : leaderboard.length > 0 ? leaderboard.map((item, idx) => (
                                        <div key={idx} className="flex items-center justify-between p-5 bg-stone-50/50 rounded-[25px] hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-stone-100">
                                            <div className="flex items-center gap-5 overflow-hidden">
                                                <span className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center font-black text-xs ${idx === 0 ? 'bg-[#8baeb2] text-white shadow-lg' : 'bg-stone-100 text-stone-400'}`}>{idx + 1}</span>
                                                <div className="overflow-hidden">
                                                    <div className="font-bold text-stone-800 text-base truncate">{item.name}</div>
                                                    <div className={`text-[9px] font-bold uppercase tracking-widest ${getRankInfo(item.score).color} truncate`}>
                                                        {getRankInfo(item.score).icon} {getRankInfo(item.score).title}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="text-right flex-shrink-0 ml-2"><span className="font-black text-stone-900 text-2xl">{item.score}</span></div>
                                        </div>
                                    )) : (
                                        <div className="text-center py-24 text-stone-400 flex flex-col items-center gap-4"><Trophy /><p className="text-xs tracking-widest text-center font-bold">ç›®å‰å°šç„¡ç´€éŒ„è³‡æ–™</p></div>
                                    )}
                                </div>
                                <button onClick={() => setView('home')} className="mt-8 w-full bg-stone-50 text-stone-400 font-bold py-4 rounded-full hover:bg-stone-100 transition-all text-xs tracking-widest text-center font-bold uppercase">é›¢é–‹æ¦œå–®</button>
                            </div>
                        )}

                        {savedImage && (
                            <div className="modal-backdrop" onClick={() => setSavedImage(null)}>
                                <div className="bg-white p-4 rounded-2xl max-w-sm w-full animate-in zoom-in duration-200 shadow-2xl relative" onClick={e => e.stopPropagation()}>
                                    <button onClick={() => setSavedImage(null)} className="absolute -top-12 right-0 text-white flex items-center gap-1 font-bold">é—œé–‰ <X /></button>
                                    <div className="text-center mb-4 text-stone-600">
                                        <p className="font-bold text-amber-600 mb-1 italic">ğŸ‰ çµæ¥­æˆåŠŸï¼</p>
                                        <p className="text-sm font-bold">æ‰‹æ©Ÿç”¨æˆ¶ï¼šé•·æŒ‰åœ–ç‰‡é»é¸ã€Œå„²å­˜ã€</p>
                                        <p className="text-sm">é›»è…¦ç”¨æˆ¶ï¼šé»æ“Šåœ–ç‰‡æŒ‰å³éµã€Œå¦å­˜ã€</p>
                                    </div>
                                    <img src={savedImage} alt="Certificate Preview" className="w-full rounded-lg shadow-lg border border-stone-200" />
                                    <button onClick={() => setSavedImage(null)} className="mt-6 w-full py-4 bg-stone-100 text-stone-600 rounded-xl font-bold font-serif hover:bg-stone-200 transition-colors">å„²å­˜å®Œæˆï¼Œé—œé–‰é è¦½</button>
                                </div>
                            </div>
                        )}

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>